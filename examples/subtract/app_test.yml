globals:
  resources:
  - ${ROOT_DIR}/assertions/app.py


tests:
- function: main
  description: >
    Orchestration function that calls the function to use for
    subtracting two numbers based on the main argument types
  cast_arguments:
  - field: data
    caster: Data
    unpack: true
  tests:
  - description: Main argument is a dataclass
    arguments:
      data:
        a: -1
        b: -1
    assertions:
    - method: assertions.app.assert_equals
      field: result
      expected: 0
    - method: assertions.app.assert_type
      expected: Data
  - description: >
      Main arguments is a dataclass and the result it cast to
      a string.
    arguments:
      data:
        a: 1
        b: 2
    cast_output:
    - caster: __builtins__.str
    assertions:
    - method: assertions.app.assert_equals
      expected: Data(a=1, b=2, result=-1)
    - method: assertions.app.assert_type
      expected: str
  - description: Trying to subtract string and integer should yield a `TypeError`
    arguments:
      data:
        a: 1
        b: '1'
    assertions:
    - method: assertions.app.assert_exception
      expected: TypeError
- function: subtract_numbers
  description: Returns the result of subtracting two numbers
  tests:
  - description: Subtract two integers
    arguments:
      a: 1
      b: 2
    assertions:
    - method: assertions.app.assert_equals
      expected: -1
    - method: assertions.app.assert_type
      expected: [int, float]
- function: subtract_dataclass
  description: Returns a dataclass containing two numbers and the result
    of subtracting the numbers
  cast_arguments:
  - field: data
    caster: Data
    unpack: true
  tests:
  - arguments:
      data:
        a: 1
        b: 2
    cast_output:
    - caster: dc.asdict
    assertions:
    - method: assertions.app.assert_equals
      expected:
        a: 1
        b: 2
        result: -1
    - method: assertions.app.assert_type
      expected:
      - dict
    # # Uncomment to fail test
    # - method: assertions.app.assert_type
    #   expected: Data  # Fails as the returned type is a dict
- function: raise_runtime_error
  description: Raises a run time error
  tests:
  - arguments: {}
    assertions:
    - method: assertions.app.assert_exception
      expected: RuntimeError
