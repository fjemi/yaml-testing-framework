resources:
- &RESOURCE_RESOURCE
  ${YAML_TESTING_FRAMEWORK_ROOT_DIR}/main/process/nodes/resources/resource.py
- &RESOURCE_TEST_YAML
  ${YAML_TESTING_FRAMEWORK_ROOT_DIR}/main/process/nodes/resources/app_test.yml
- &RESOURCE
  resource: &RESOURCE_PATH ${YAML_TESTING_FRAMEWORK_ROOT_DIR}/main/process/nodes/resources/app.py
- &CHECKS
  resource: ${YAML_TESTING_FRAMEWORK_ROOT_DIR}/checks/app.py


tests:
- function: main
  description: >
    Returns a list of tests from data collected from data in YAML files
  tests:
  - description: Undefined arguments
    arguments: {}
    checks:
    - method: check_sns
      << : *CHECKS
      expected:
        tests: []
  - description: Defined arguments
    arguments:
      yaml: *RESOURCE_TEST_YAML
      module: *RESOURCE_PATH
      module_route: *RESOURCE_PATH
    cast_output:
    - method: check_equals
      << : *CHECKS
      expected:
        tests:
        - arguments: {}
          checks: []
          cast_arguments: []
          cast_output: []
          description:
          - description_a
          environment: {}
          exclude_methods: []
          include_methods: []
          function: null
          function_name: null
          id: null
          id_long: null
          id_short: null
          key: null
          module: *RESOURCE_PATH
          module_route: *RESOURCE_PATH
          output: null
          patches: []
          spies: []
          tests: null
          yaml: *RESOURCE_TEST_YAML
        - arguments: {}
          checks: []
          cast_arguments: []
          cast_output: []
          description:
          - description_b
          - description_b0
          environment: {}
          exclude_methods: []
          include_methods: []
          function: null
          function_name: null
          id: null
          id_long: null
          id_short: null
          key: '0.0'
          module: *RESOURCE_PATH
          module_route: *RESOURCE_PATH
          output: null
          patches: []
          spies: []
          tests: null
          yaml: *RESOURCE_TEST_YAML
        - arguments: {}
          checks: []
          cast_arguments: []
          cast_output: []
          description:
          - description_b
          - description_b1
          environment: {}
          exclude_methods: []
          include_methods: []
          function: null
          function_name: null
          id: null
          id_long: null
          id_short: null
          key: '0.1'
          module: *RESOURCE_PATH
          module_route: *RESOURCE_PATH
          output: null
          patches: []
          spies: []
          tests: null
          yaml: *RESOURCE_TEST_YAML
- function: get_configurations_and_tests
  description: >
    Returns the contents of a YAML file or an empty dictionary if the file
    does not exist
  tests:
  - description: Undefined arguments
    arguments: {}
    checks:
    - method: check_sns
      << : *CHECKS
      expected:
        configurations: {}
        tests: []
  - description: YAML location does not exist
    arguments:
      yaml: location/does/not/exist.yaml
    checks:
    - method: check_sns
      << : *CHECKS
      expected:
        configurations: {}
        tests: []
  - description: YAML location does exist
    arguments:
      yaml: *RESOURCE_TEST_YAML
    checks:
    - method: check_sns
      << : *CHECKS
      expected:
        configurations: {}
        tests:
        - description: description_a
        - description: description_b
          tests:
          - description: description_b0
          - description: description_b1
- function: format_locations
  description: Formats locations as a simple name space
  tests:
  - description: Undefined arguments
    arguments: {}
    checks:
    - method: check_sns
      << : *CHECKS
      expected:
        module: null
        module_route: null
        yaml: null
    - method: check_sns
      << : *CHECKS
      field: locations
      expected:
        module: null
        module_route: null
        yaml: null
  - description: Defined arguments
    arguments:
      module: module
      module_route: module_route
      yaml: yaml
    checks:
    - method: check_sns
      << : *CHECKS
      expected:
        module: null
        module_route: null
        yaml: null
    - method: check_sns
      << : *CHECKS
      field: locations
      expected:
        module: module
        module_route: module_route
        yaml: yaml
- function: add_locations_to_configurations
  description: >
    Adds module, yaml, and other location data to global config data
  cast_arguments:
  - field: locations
    method: sns
    unpack: true
  tests:
  - description: Empty arguments
    arguments:
      configurations: {}
      locations: {}
    checks:
    - method: check_sns
      << : *CHECKS
      expected:
        locations: null
        configurations: {}
  - description: Defined arguments
    arguments:
      configurations: {}
      locations:
        module: module
        module_route: module_route
        yaml: yaml
    checks:
    - method: check_sns
      << : *CHECKS
      expected:
        locations: null
        configurations:
          module: module
          module_route: module_route
          yaml: yaml
- function: get_expanded_nodes
  description: >
    Adds configurations to root nodes and expands data in roots to nested nodes
  cast_output:
  - method: sns_to_dict
    << : *RESOURCE
    field: tests
  tests:
  - description: Empty arguments
    arguments:
      configurations: {}
      tests: []
    checks:
    - method: check_sns
      << : *CHECKS
      expected:
        tests: []
  - description: One node with no nested nodes
    arguments:
      configurations: {}
      tests:
      - description: description_a
    checks:
    - method: check_sns
      << : *CHECKS
      expected:
        tests:
        - arguments: {}
          checks: []
          cast_arguments: []
          cast_output: []
          description:
          - description_a
          environment: {}
          exclude_methods: []
          include_methods: []
          function: null
          function_name: null
          id: null
          id_long: null
          id_short: null
          key: null
          module: null
          module_route: null
          output: null
          patches: []
          spies: []
          tests: null
          yaml: null
  - description: Single node with nested nodes
    arguments:
      configurations: {}
      tests:
      - description: root
        tests:
        - description: nested_0
        - description: nested_1
    checks:
    - method: check_sns
      << : *CHECKS
      expected:
        tests:
        - arguments: {}
          checks: []
          cast_arguments: []
          cast_output: []
          description:
          - root
          - nested_0
          environment: {}
          exclude_methods: []
          include_methods: []
          function: null
          function_name: null
          id: null
          id_long: null
          id_short: null
          key: '0.0'
          module: null
          module_route: null
          output: null
          patches: []
          spies: []
          tests: null
          yaml: null
        - arguments: {}
          checks: []
          cast_arguments: []
          cast_output: []
          description:
          - root
          - nested_1
          environment: {}
          exclude_methods: []
          include_methods: []
          function: null
          function_name: null
          id: null
          id_long: null
          id_short: null
          key: '0.1'
          module: null
          module_route: null
          output: null
          patches: []
          spies: []
          tests: null
          yaml: null
